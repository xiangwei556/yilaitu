# 支付配置检查指南

## 当前配置状态

根据配置检查结果，部分支付配置还未正确加载。请按以下步骤检查：

## 1. 检查 .env 文件位置

确保 `.env` 文件位于 `backend/.env`（与 `backend/passport/app/core/config.py` 同级目录）

## 2. 配置项格式

`.env` 文件中的配置格式应为：

```env
# 微信支付配置
WECHAT_PAY_APP_ID=your_wechat_app_id
WECHAT_PAY_MCH_ID=your_merchant_id
WECHAT_PAY_API_KEY=your_api_key
WECHAT_PAY_API_V3_KEY=your_api_v3_key
WECHAT_PAY_CERT_PATH=/path/to/cert.pem
WECHAT_PAY_NOTIFY_URL=https://your-domain.com/api/v1/payment/wechat/callback

# 支付宝配置
ALIPAY_APP_ID=your_alipay_app_id
ALIPAY_PRIVATE_KEY=your_private_key
ALIPAY_PUBLIC_KEY=your_alipay_public_key
ALIPAY_NOTIFY_URL=https://your-domain.com/api/v1/payment/alipay/callback
ALIPAY_RETURN_URL=https://your-domain.com/payment/return
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do

# 订单配置（可选，已有默认值）
ORDER_EXPIRE_MINUTES=30
QR_CODE_EXPIRE_MINUTES=15
PAYMENT_QUERY_RETRY_MAX=5
```

## 3. 重要提示

### 3.1 支付宝私钥格式
支付宝私钥应该是完整的PEM格式，包含 `-----BEGIN RSA PRIVATE KEY-----` 和 `-----END RSA PRIVATE KEY-----`

如果配置多行内容，可以使用：
```env
ALIPAY_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
```

### 3.2 证书路径
微信支付证书路径应该是绝对路径，例如：
```env
WECHAT_PAY_CERT_PATH=D:/certs/apiclient_cert.pem
```

### 3.3 回调地址
回调地址在生产环境必须是HTTPS，开发环境可以使用内网穿透工具（如ngrok）

## 4. 验证配置

运行配置检查脚本：
```bash
python backend/payment/test_config.py
```

## 5. 重启服务

配置修改后，需要重启后端服务才能生效：
```bash
python backend/main.py
```

## 6. 下一步

配置完成后：
1. ✅ 数据库迁移已完成
2. ⏳ 配置支付参数（当前进行中）
3. ⏳ 启动服务并测试支付功能
4. ⏳ 配置支付平台回调地址
