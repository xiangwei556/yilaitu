# 前后端服务启动操作规范

## 1. 基础配置说明

### 1.1 后端服务
- **运行端口**：8001
- **启动命令**：`python -m uvicorn main:app --reload --port 8001`
- **项目路径**：`d:/trae_projects/image-edit/backend`
- **服务访问**：http://localhost:8001

### 1.2 前端服务
- **运行端口**：80
- **启动命令**：`npm run dev`
- **项目路径**：`d:/trae_projects/image-edit/frontend`
- **服务访问**：http://yilaitu.com 或 http://localhost
- **允许的主机**：yilaitu.com, 0.0.0.0, localhost

### 1.3 关键配置文件

#### 1.3.1 前端 Vite 配置
**文件路径**：`d:/trae_projects/image-edit/frontend/vite.config.js`
**核心配置**：
```javascript
server: {
  port: 80,
  host: '0.0.0.0',
  allowedHosts: ['yilaitu.com', '0.0.0.0', 'localhost'],
  proxy: {
    '/api': {
      target: 'http://localhost:8001',
      changeOrigin: true,
      rewrite: (path) => path
    }
  }
}
```

**文件路径**：`d:/trae_projects/image-edit/frontend/vite.config.ts`
**核心配置**：
```typescript
server: {
  port: 80,
  host: '0.0.0.0',
  allowedHosts: ['yilaitu.com', '0.0.0.0', 'localhost'],
  proxy: {
    '/api': {
      target: 'http://localhost:8001',
      changeOrigin: true,
    }
  }
}
```

#### 1.3.2 前端 API 请求配置
**文件路径**：`d:/trae_projects/image-edit/frontend/src/utils/request.js`
**核心配置**：
```javascript
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api/v1',
  timeout: 5000,
});
```

#### 1.3.3 环境变量配置
**文件路径**：`d:/trae_projects/image-edit/frontend/.env`
**核心配置**：
```
VITE_API_BASE_URL=/api/v1
```

## 2. 服务启动流程

### 2.1 启动顺序
1. **首先启动后端服务**
2. **然后启动前端服务**

### 2.2 启动后端服务
**操作步骤**：
1. 打开终端，切换到后端项目目录：`cd d:/trae_projects/image-edit/backend`
2. 执行启动命令：`python -m uvicorn main:app --reload --port 8001`
3. 验证服务：检查终端输出，确保看到 `Uvicorn running on http://127.0.0.1:8001`

### 2.3 启动前端服务
**操作步骤**：
1. 打开终端，切换到前端项目目录：`cd d:/trae_projects/image-edit/frontend`
2. 执行启动命令：`npm run dev`
3. 验证服务：检查终端输出，确保看到 `Local: http://localhost:80/` 和 `Network: http://192.168.x.x:80/`

### 2.4 验证服务连通性
1. 访问前端页面：http://yilaitu.com
2. 尝试登录或访问任意需要API的功能
3. 检查前端控制台，确认API请求返回200状态码
4. 检查后端终端，确认收到API请求日志

## 3. 服务重启流程

### 3.1 重启后端服务
**操作步骤**：
1. 在运行后端服务的终端中，按 `Ctrl + C` 停止服务
2. 重新执行启动命令：`python -m uvicorn main:app --reload --port 8001`
3. 验证服务：确保看到服务启动成功的日志

### 3.2 重启前端服务
**操作步骤**：
1. 在运行前端服务的终端中，按 `Ctrl + C` 停止服务
2. 重新执行启动命令：`npm run dev`
3. 验证服务：确保看到服务启动成功的日志

### 3.3 重启前后端服务
**操作步骤**：
1. 先按照3.1的步骤重启后端服务
2. 再按照3.2的步骤重启前端服务
3. 验证服务连通性

## 4. 常见问题排查

### 4.1 前端访问被阻止
**错误信息**：`Blocked request. This host ("yilaitu.com") is not allowed.`
**解决方案**：检查 `vite.config.js` 和 `vite.config.ts` 中的 `allowedHosts` 配置，确保包含 `yilaitu.com`

### 4.2 前端无法访问后端API
**错误信息**：`404 Not Found` 或 `500 Internal Server Error`
**解决方案**：
1. 检查后端服务是否正常运行在8001端口
2. 检查前端 Vite 配置中的代理设置是否正确
3. 检查前端 API 请求的基础URL是否为 `/api/v1`

### 4.3 端口被占用
**错误信息**：`Error: listen EACCES: permission denied :::80`
**解决方案**：
1. 检查端口80是否被其他进程占用
2. 使用管理员权限运行前端服务

### 4.4 服务启动无响应
**解决方案**：
1. 检查项目目录是否正确
2. 检查依赖是否已安装：`npm install`（前端）或 `pip install -r requirements.txt`（后端）
3. 查看终端输出的详细错误信息

## 5. 注意事项

1. **配置文件同步**：由于项目中同时存在 `vite.config.js` 和 `vite.config.ts`，修改配置时必须同时修改两个文件，保持配置一致

2. **端口占用**：
   - 后端固定使用8001端口
   - 前端固定使用80端口（需要管理员权限）

3. **访问方式**：
   - 优先使用 `http://yilaitu.com` 访问前端
   - 避免直接使用 `http://localhost:80` 或 `http://yilaitu.com:80`

4. **代理配置**：
   - 前端所有 `/api` 请求会自动转发到后端 `http://localhost:8001`
   - 无需修改前端代码中的API地址

5. **服务依赖**：
   - 前端依赖 Node.js 和 npm
   - 后端依赖 Python 3.8+ 和 FastAPI

## 6. 快速操作脚本

### 6.1 启动后端服务脚本
```batch
@echo off
cd /d "d:/trae_projects/image-edit/backend"
python -m uvicorn main:app --reload --port 8001
pause
```

### 6.2 启动前端服务脚本
```batch
@echo off
cd /d "d:/trae_projects/image-edit/frontend"
npm run dev
pause
```

### 6.3 重启前后端服务脚本
```batch
@echo off
echo 正在重启后端服务...
start "后端服务" cmd /k "cd /d d:/trae_projects/image-edit/backend && python -m uvicorn main:app --reload --port 8001"
echo 正在重启前端服务...
start "前端服务" cmd /k "cd /d d:/trae_projects/image-edit/frontend && npm run dev"
echo 服务重启完成，请检查终端窗口确认服务状态
pause
```

---

**版本**：1.0
**创建日期**：2025-12-19
**适用场景**：日常开发、测试环境服务启动